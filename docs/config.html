<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ABINIT</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"  crossorigin="anonymous" />
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="./styles.css"
        rel="stylesheet"> <!-- Link to your external CSS file -->
</head>

<body>
<div class="icon-container">
    <div class="icon-row">
        <div>
            <a href="./index.html">
                <img alt="ABINIT" src="./logo/logo.png"
                     title="" height="100"/>
                <span class="title"></span>
            </a>
        </div>

    </div>

    <div class="icon-row">
        <div class="icon">
            <a href="./pseudopotential.html">
                <img alt="Pseudo and atomic data" class="icon" src="./img/Pseudos.png" title="pseudopotential" />
                <span class="title">Pseudos &amp; PAW data</span>
            </a>
        </div>
        <div class="icon">
            <a href="https://docs.abinit.org/variables">
                <img alt="input variables" class="icon" src="./img/input_variables.png" title="Input variables" />
                <span class="title">Input variables</span>
            </a>
        </div>
        <div class="icon">
            <a href="https://docs.abinit.org/tutorial/">
                <img alt="Tutorials" class="icon" src="./img/Tutorials.png" title="Tutorials" />
                <span class="title">Tutorials</span>
            </a>
        </div>
        <div class="icon">
            <a href="https://discourse.abinit.org/">
                <img alt="Forum" class="icon" src="./img/Forum.png" title="Forum" />
                <span class="title">Forum</span>
            </a>
        </div>
        <div class="icon">
            <a href="./download.html">
                <img alt="Download" class="icon" src="./img/Download.png" title="Download" />
                <span class="title">Download</span>
            </a>
        </div>
        <div class="icon">
            <a href="https://docs.abinit.org/installation/">
                <img alt="Compile" class="icon" src="./img/Compile.png" title="Compile" />
                <span class="title">Compile</span>
            </a>
        </div>
            <div class="icon">
            <a href="https://github.com/abinit">
                <img alt="GitHub" class="icon" src="./img/git.png" title="GitHub" />
                <span class="title">GitHub</span>
            </a>
        </div>
        <div class="icon">
            <a href="https://gui.abinit.org/">
                <img alt="GUI" class="icon" src="./img/gui.png" title="GUI" />
                <span class="title">GUI</span>
            </a>
        </div>
        <div class="icon">
            <a href="https://github.com/abinit/abipy">
                <img alt="abipy" class="icon" src="./img/abipy.png" title="abipy" />
                <span class="title">Abipy</span>
            </a>
        </div>
</div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<div class="separator-line1"></div>
<div class="abinit-info">
    <h1>Configuring the Build of Abinit</h1>

    <p><em>Please read the <a href="./conventions.html" style="color: #F18F34;">Conventions and
        formatting</a> page at least once before everything else.</em></p>

    <h2>Tutorials for Beginners</h2>
    <ul>
        <li><a href="./installing_abinit.pdf" target="_blank" style="color: #F18F34;"><img
                src="./installing_abinit.pdf"
                                             alt="Installing Abinit PDF" /></a></li>
    </ul>

    <h2>The Configure Script</h2>
    <p>
        The <em>configure</em> script is a portable shell-script generated by
        <a href="http://www.gnu.org/software/autoconf/" style="color: #F18F34;">Autoconf</a> from a file called <em>configure.ac</em> or <em>configure.in</em>. It contains a sequence of commands depending on the software package it belongs to and the purpose of which is to detect the components needed to build this package.
    </p>
    <p>
        The commonly accepted default behavior is that the <em>configure</em> script should be able to provide working build parameters when run without option. However, to let users interact with it and customize its behavior, Autoconf provides a mechanism to transmit command-line options to <em>configure</em>. There are two kinds of options:
    </p>
    <ul>
        <li>Switches, to turn simple features on and off, available through the <em>enable_*</em> shell variables and <em>--enable-*</em> / <em>--disable-*</em> on the command line.</li>
        <li>Optional packages, to enable or disable support for external dependencies and complex features, available through the <em>with_*</em> shell variables and <em>--with-*</em> / <em>--without-*</em> on the command line.</li>
    </ul>
    <p>
        In addition, the <em>configure</em> script comes with built-in standard options to customize the installation of the package and lets the developers mark some environment variables as important.
    </p>

    <div style="border: 1px solid #ddd; padding: 10px; background-color: #f9f9f9;">
        <strong>Tip:</strong> Whenever possible, we refer to the options of the <em>configure</em> script as shell variables, which is the way they appear in the config files of Abinit. Their names contain letters, digits, and underscores. On the command line, all underscores are replaced with dashes and option names are prefixed with two dashes. As an example, the option to specify the Fortran compiler vendor appears as <em>with_fc_vendor</em> in the config file, while it is typed <em>--with-fc-vendor</em> on the command line.
    </div>

    <p>
        To obtain the full list of available options and their documentation, just type:
    </p>
    <code>./configure --help</code>
    <p>
        from the top source directory of any Autoconf-powered software package. With Abinit, you will get a long list of options and environment variables. Reading it at least once is a very good way to become aware of the possible optimizations offered at configure-time and get some familiarity with the underlying philosophy of the build system.
    </p>

    <h2>Environment Variables</h2>

    <p>
        If you have run the <em>./configure --help</em> command, you will have already noticed that Abinit can be configured through various environment variables. A few others, not listed by <em>configure</em>, are also of great importance, and we will describe them in this section.
    </p>

    <h3>Using Environment Variables</h3>

    <p>
        Setting an environment variable is usually done using the variable name directly, e.g.:
    </p>
    <code>LD_LIBRARY_PATH="/opt/my_package/lib"</code>
    <p>
        while querying it is done by prefixing its name with a dollar sign, e.g.:
    </p>
    <code>echo $LD_LIBRARY_PATH</code>
    <p>
        Quite often, the situation happens to be a mix of both, e.g.:
    </p>
    <code>export LD_LIBRARY_PATH="/opt/my_package/lib:$LD_LIBRARY_PATH"</code>

    <div style="border: 1px solid #ddd; padding: 10px; background-color: #f9f9f9;">
        <strong>Tip:</strong> <strong>Availability of environment variables</strong> In order to be available beyond the current shell context, variables often have to be exported. This is done using the <em>export</em> instruction with Bourne-like shells, and <em>setenv</em> with C-like shells. If the <em>configure</em> script does not take an environment variable into account, it is likely because you did not export it.
    </div>

    <h3>PATH</h3>

    <p>
        The <em>PATH</em> environment variable tells the system where to look for relevant programs. It consists of a colon-separated list of directories containing executable files. The following is a typical value that can be obtained from the command line:
    </p>
    <code>
        $ echo $PATH<br>
        /home/abinit/bin:/usr/local/bin:/usr/bin:/bin
    </code>
    <p>
        The <em>configure</em> script looks for various programs, in order to decide which features should be enabled and which ones not. In particular, if you use Abinit Fallbacks, you should make sure that your PATH contains the directory containing the <em>abinit-fallbacks-config</em> program before running <em>configure</em>, e.g.:
    </p>
    <code>$ export PATH="/fallbacks/install/directory/bin:$PATH"</code>

    <h3>LD_LIBRARY_PATH</h3>

    <p>
        Equally essential, <em>LD_LIBRARY_PATH</em> is to libraries what <em>PATH</em> is to programs, and works exactly the same: it is a colon-separated list of directories containing shared libraries. On Unix systems, these libraries have a ".so" extension. On macOS, their extension is ".dylib". On Windows, it is ".dll". A typical setting with a strict Bourne Shell is:
    </p>
    <code>
        $ LD_LIBRARY_PATH="/path/to/abinit/dependency/lib:$LD_LIBRARY_PATH"<br>
        $ export LD_LIBRARY_PATH
    </code>
    <p>
        Please note that <em>LD_LIBRARY_PATH</em> is called <em>DYLD_LIBRARY_PATH</em> on macOS.
    </p>

    <div style="border: 1px solid #ddd; padding: 10px; background-color: #f9f9f9;">
        <strong>IMPORTANT:</strong> <em>LD_LIBRARY_PATH</em> must be set <strong>to the same value</strong> both before configuring the build of Abinit and before running the corresponding executables. These two actions can happen at very different times, hence the risk of forgetting to set the variable again. Misconfiguring <em>LD_LIBRARY_PATH</em> is actually a common mistake beginners make when learning Abinit and the source of many questions asked on the <a href="https://forum.abinit.org/">Abinit Forums</a>.
    </div>

    <h3>LIBRARY_PATH</h3>

    <p>
        If you use GCC compilers, you may sometimes want to use the <em>LIBRARY_PATH</em> environment variable as well, in particular if the build fails while <em>LD_LIBRARY_PATH</em> has been correctly set. Contrary to the latter, <em>LIBRARY_PATH</em> is only used by the compiler at link-time and will be ignored when running an Abinit executable.
    </p>

    <h3>PYTHONPATH</h3>

    <p>
        Python is usually installed by system administrators in a standard way on most computers. However, if you use custom Python modules that you have installed yourself, please make sure that the PYTHONPATH variable is properly set before configuring Abinit.
    </p>

    <h3>Language-Specific Variables</h3>

    <p>
        From time to time, some compilers complain or do not display important messages because language support is improperly configured on your computer. Should this happen, we recommend you to type the following:
    </p>
    <code>
        $ LANG=C; LC_ALL=C<br>
        $ export LANG LC_ALL
    </code>
    <p>
        This will reset the language support to its most basic defaults and will make sure that you get all messages from the compilers -- in English, of course.
    </p>

    <h2>Using a Build Directory</h2>

    <p><strong>We strongly recommend you to systematically use a build directory different from the source tree when compiling Abinit.</strong> Usually, this is done by creating a new subdirectory at the top of the Abinit source tree and is as simple as typing:</p>
    <code>cd ~abinit && mkdir my_build_dir && cd my_build_dir && ../configure</code>
    <p>
        Besides being a standard way to proceed with most Autotools-based software packages, this is much cleaner than building directly in the source tree, since it clearly separates the built files from the source files and keeps the latter untouched. If your build fails for any reason, you can always restart with the guarantee of a pristine source tree by simply removing the contents of the build directory or creating a new one.
    </p>
    <p>
        If you wish, you can even build Abinit fully outside its source tree by creating a build directory anywhere and using the <em>--srcdir</em> option of <em>configure</em>.
    </p>

    <div style="border: 1px solid #ddd; padding: 10px; background-color: #f9f9f9;">
        <strong>Tip:</strong> <strong>Naming convention for developers</strong> If you are a developer of Abinit, we recommend you to name your build directory <em>tmp</em> or to use <em>tmp-</em> as a prefix to its name, in order to have it automatically ignored by the Version Control System.
    </div>

    <h2>Using a Config File</h2>

    <p>
        When using some options repeatedly, it quickly becomes tedious to type them again and again on the command line. On the other hand, if you only compile Abinit once in a while, you will likely forget the options that you used previously between two builds. This is why we provide an alternative way to provide options to the <em>configure</em> script, through the use of config files.
    </p>
    <p>
        In order to accommodate as many situations as possible, we have designed a flexible mechanism to handle config files:
    </p>
    <ul>
        <li>First, the build system looks into the build directory for a config file, which lets you import parameters for a specific build.</li>
        <li>If not found, it looks into the source directory, which allows you to use build parameters related to a particular version of Abinit.</li>
        <li>If still not found, it looks into the <em>~/.abinit/build/</em> directory, which acts as a provider of default parameters corresponding to your particular preferences.</li>
        <li>Finally, it looks into the <em>/etc/abinit/build/</em> directory, to let system administrators provide system-wide parameters for a specific computer.</li>
    </ul>
    <p>
        Of these four possibilities, the first file encountered is processed and the build system goes on without looking for more files. In other words, config files are not cumulative. For example, if a user has a <em>~/.abinit/build/my_host.ac</em>, the system-wide defaults found in <em>/etc/abinit/build/my_host.ac</em> will always be ignored.
    </p>
    <p>
        Since many developers of Abinit work on shared filesystems, the build system looks by default for a file called <em>`hostname`.ac</em>, where `hostname` represents the result of the following command, that you can type in a shell to know how to name your config files (do not type the dollar signs):
    </p>
    <code>
        $ hostname<br>
        wiki<br>
        $
    </code>
    <p>
        In the current example, you would name your config file <em>wiki.ac</em> if you want the build system to take it into account by default.
    </p>
    <p>
        This operation has to be repeated once on every computer where you want to build Abinit using a config file. We chose this strategy to make sure that the build system will always take the correct config file even in the case several computers would share the same home directory.
    </p>
    <p>
        You will find detailed instructions on how to set the various options of the configure script in the template file <em>~abinit/doc/build/config-template.ac</em>, including how to have your config file included automatically each time you build Abinit. There are only two undocumented options in this template:
    </p>
    <ul>
        <li>The <em>--with-config-file</em> option, which lets you use arbitrary names for your config files, as long as you specify it each time on the command line.</li>
        <li>The <em>--disable-config-file</em> option, to force Abinit not to use any config file.</li>
    </ul>
    <p>
        For obvious reasons, they are the only options that cannot be stored in a config file.
    </p>

    <h2>Tuning Configure Options</h2>

    <div style="border: 1px solid #ddd; padding: 10px; background-color: #f9f9f9;">
        <strong>Important tip:</strong> The options of <em>configure</em> are fully documented in the <em>~abinit/doc/build/config-template.ac</em> file. Even if the wiki is updated quickly to reflect the changes made to this file, there may sometimes be a slight delay before both documents are synchronized. If you find a discrepancy between the wiki and <em>config-template.ac</em>, please let us know as soon as possible so that we can fix it -- or fix it yourself if you have write permission on this wiki.
    </div>

    <p>
        The build system of Abinit is quite modular and is composed of logical blocks addressing each a specific configuration issue. The following documents will help you tune the build parameters depending on what you want to adjust.
    </p>

    <ul>
        <li><a href="build:compilers" style="color: #F18F34;">Configuring compilers</a> helps you
            select C, C++, and Fortran compilers, and find the best compromise between performance and reliability for your architecture. It includes a section on preprocessors and the corresponding platform-specific issues.</li>
        <li><a href="build:multicore_architectures" style="color: #F18F34;">Configuring multicore
            architectures</a> shows how to configure OpenMP-, MPI-, and GPU-enabled architectures, as well as how to force a build to remain serial.</li>
        <li><a href="linear_algebra.html" style="color: #F18F34;">Configuring
            linear algebra</a>
            explains how to configure linear algebra support for your particular situation.</li>
        <li><a href="build:fft" style="color: #F18F34;">Configuring Fast Fourier Transforms</a>
            guides you to select the best FFT algorithm for your particular situation.</li>
        <li><a href="./feature_triggers.html"
               style="color: #F18F34;">Configuring feature
            triggers</a> provides you with useful advice on how to enhance the capabilities of Abinit with external packages.</li>
    </ul>
</div>
</body>
</html>

